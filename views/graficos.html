<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estad√≠sticas y Gr√°ficos - IESTP Ca√±ete</title>
    <meta name="description" content="Panel de estad√≠sticas y an√°lisis de asistencias del sistema de registro">
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/graficos.css">
    <link rel="icon" type="image/png" href="../assets/img/logo iestp.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Bot√≥n de toggle para m√≥vil -->
    <button class="toggle-button" onclick="toggleSidebar()">‚ò∞</button>

    <!-- Sidebar de navegaci√≥n -->
    <div class="sidebar">  
        <h2>üìä Estad√≠sticas</h2>
        <ul>
            <li><a href="admin.html">üè† Inicio</a></li>
            <li><a href="#" onclick="mostrarSeccion('general')" class="active">üìà General</a></li>
            <li>
                <select onchange="filtrarPorEspecialidad(this.value)">
                    <option value="" selected disabled>üéì Especialidades</option>
                    <option value="arquitectura">Arquitectura</option>
                    <option value="enfermeria">Enfermer√≠a</option>
                    <option value="agropecuaria">Agropecuaria</option>
                    <option value="contabilidad">Contabilidad</option>
                    <option value="electronica">Electr√≥nica</option>
                </select>
            </li>
            <li><a href="#" onclick="mostrarSeccion('asistencias')">üìã Asistencias</a></li>
            <li><a href="#" onclick="mostrarSeccion('top10')">üèÜ Top 10</a></li>
            <li><a href="#" onclick="mostrarSeccion('alumnos')">üë• Alumnos</a></li>
        </ul>
    </div>

    <!-- Contenido principal -->
    <div class="content">

        <!-- Secci√≥n General -->
        <section id="general" class="section active">
            <div class="section-content">
                <!-- Estad√≠sticas r√°pidas -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value">379</span>
                        <span class="stat-label">Total Alumnos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">156</span>
                        <span class="stat-label">Asistencias Hoy</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">78%</span>
                        <span class="stat-label">Promedio Asistencia</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">5</span>
                        <span class="stat-label">Especialidades</span>
                    </div>
                </div>

                <!-- Tarjetas de informaci√≥n -->
                <div class="cards-container">
                    <div class="card">
                        <h3>Total Alumnos</h3>
                        <p><strong>379</strong></p>
                    </div>

                    <div class="card">
                        <h3>Especialidades</h3>
                        <p>Arquitectura: 76</p>
                        <p>Enfermer√≠a: 82</p>
                        <p>Agropecuaria: 71</p>
                        <p>Contabilidad: 78</p>
                        <p>Electr√≥nica: 72</p>
                    </div>

                    <div class="card">
                        <h3>Ciclos</h3>
                        <p>1er A√±o: 127</p>
                        <p>2do A√±o: 126</p>
                        <p>3er A√±o: 126</p>
                    </div>
                </div>

                <!-- Gr√°ficos principales -->
                <div class="cards-container cards-70-30">
                    <div class="card">
                        <h3>Asistencias de la semana</h3>
                        <canvas id="graficoSemana"></canvas>
                    </div>

                    <div class="card">
                        <h3>Asistencias del d√≠a</h3>
                        <canvas id="graficoCircular"></canvas>
                    </div>
                </div>

                <div class="cards-container cards-30-70">
                    <div class="card">
                        <h3>Asistencias del a√±o</h3>
                        <canvas id="graficoAnual"></canvas>
                    </div>

                    <div class="card">
                        <h3>Asistencias del mes</h3>
                        <canvas id="graficoMensual"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="arquitectura" class="section">
             <div class="section-content">
    <!-- Filtros: A√±o y Ciclo -->
    <div class="filter-row" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <div>
        <label for="a√±oArquitectura">A√±o:</label>
        <select id="a√±oArquitectura" onchange="actualizarGraficosEspecialidad('arquitectura')"></select>
      </div>
      <div class="botones-ciclo">
        <button onclick="cambiarCiclo('arquitectura', 'total')">Total</button>
        <button onclick="cambiarCiclo('arquitectura', '1')">1er A√±o</button>
        <button onclick="cambiarCiclo('arquitectura', '2')">2do A√±o</button>
        <button onclick="cambiarCiclo('arquitectura', '3')">3er A√±o</button>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="cards-container">
      <div class="card">
        <h3>Asistencias de la semana</h3>
        <canvas id="graficoSemanaArquitectura"></canvas>
      </div>
    </div>

    <div class="cards-container cards-30-70">
      <div class="card">
        <h3>Asistencias del a√±o</h3>
        <canvas id="graficoAnualArquitectura"></canvas>
      </div>

      <div class="card">
        <h3>Asistencias del d√≠a</h3>
        <canvas id="graficoDiaArquitectura"></canvas>
      </div>
    </div>
  </div>
        </section>

        <section id="enfermeria" class="section">
             <div class="section-content">
    <!-- Filtros: A√±o y Ciclo -->
    <div class="filter-row" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <div>
        <label for="a√±oEnfermeria">A√±o:</label>
        <select id="a√±oEnfermeria" onchange="actualizarGraficosEspecialidad('enfermeria')"></select>
      </div>
      <div class="botones-ciclo">
        <button onclick="cambiarCiclo('enfermeria', 'total')">Total</button>
        <button onclick="cambiarCiclo('enfermeria', '1')">1er A√±o</button>
        <button onclick="cambiarCiclo('enfermeria', '2')">2do A√±o</button>
        <button onclick="cambiarCiclo('enfermeria', '3')">3er A√±o</button>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="cards-container">
      <div class="card">
        <h3>Asistencias de la semana</h3>
        <canvas id="graficoSemanaEnfermeria"></canvas>
      </div>
    </div>

    <div class="cards-container cards-30-70">
      <div class="card">
        <h3>Asistencias del a√±o</h3>
        <canvas id="graficoAnualEnfermeria"></canvas>
      </div>

      <div class="card">
        <h3>Asistencias del d√≠a</h3>
        <canvas id="graficoDiaEnfermeria"></canvas>
      </div>
    </div>
  </div>
        </section>

        <section id="agropecuaria" class="section">
             <div class="section-content">
    <!-- Filtros: A√±o y Ciclo -->
    <div class="filter-row" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <div>
        <label for="a√±oAgropecuaria">A√±o:</label>
        <select id="a√±oAgropecuaria" onchange="actualizarGraficosEspecialidad('agropecuaria')"></select>
      </div>
      <div class="botones-ciclo">
        <button onclick="cambiarCiclo('agropecuaria', 'total')">Total</button>
        <button onclick="cambiarCiclo('agropecuaria', '1')">1er A√±o</button>
        <button onclick="cambiarCiclo('agropecuaria', '2')">2do A√±o</button>
        <button onclick="cambiarCiclo('agropecuaria', '3')">3er A√±o</button>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="cards-container">
      <div class="card">
        <h3>Asistencias de la semana</h3>
        <canvas id="graficoSemanaAgropecuaria"></canvas>
      </div>
    </div>

    <div class="cards-container cards-30-70">
      <div class="card">
        <h3>Asistencias del a√±o</h3>
        <canvas id="graficoAnualAgropecuaria"></canvas>
      </div>

      <div class="card">
        <h3>Asistencias del d√≠a</h3>
        <canvas id="graficoDiaAgropecuaria"></canvas>
      </div>
    </div>
  </div>
        </section>

        <section id="contabilidad" class="section">
             <div class="section-content">
    <!-- Filtros: A√±o y Ciclo -->
    <div class="filter-row" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <div>
        <label for="a√±oContabilidad">A√±o:</label>
        <select id="a√±oContabilidad" onchange="actualizarGraficosEspecialidad('contabilidad')"></select>
      </div>
      <div class="botones-ciclo">
        <button onclick="cambiarCiclo('contabilidad', 'total')">Total</button>
        <button onclick="cambiarCiclo('contabilidad', '1')">1er A√±o</button>
        <button onclick="cambiarCiclo('contabilidad', '2')">2do A√±o</button>
        <button onclick="cambiarCiclo('contabilidad', '3')">3er A√±o</button>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="cards-container">
      <div class="card">
        <h3>Asistencias de la semana</h3>
        <canvas id="graficoSemanaContabilidad"></canvas>
      </div>
    </div>

    <div class="cards-container cards-30-70">
      <div class="card">
        <h3>Asistencias del a√±o</h3>
        <canvas id="graficoAnualContabilidad"></canvas>
      </div>

      <div class="card">
        <h3>Asistencias del d√≠a</h3>
        <canvas id="graficoDiaContabilidad"></canvas>
      </div>
    </div>
  </div>
        </section>

        <section id="electronica" class="section">
             <div class="section-content">
    <!-- Filtros: A√±o y Ciclo -->
    <div class="filter-row" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
      <div>
        <label for="a√±oElectronica">A√±o:</label>
        <select id="a√±oElectronica" onchange="actualizarGraficosEspecialidad('electronica')"></select>
      </div>
      <div class="botones-ciclo">
        <button onclick="cambiarCiclo('electronica', 'total')">Total</button>
        <button onclick="cambiarCiclo('electronica', '1')">1er A√±o</button>
        <button onclick="cambiarCiclo('electronica', '2')">2do A√±o</button>
        <button onclick="cambiarCiclo('electronica', '3')">3er A√±o</button>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="cards-container">
      <div class="card">
        <h3>Asistencias de la semana</h3>
        <canvas id="graficoSemanaElectronica"></canvas>
      </div>
    </div>

    <div class="cards-container cards-30-70">
      <div class="card">
        <h3>Asistencias del a√±o</h3>
        <canvas id="graficoAnualElectronica"></canvas>
      </div>

      <div class="card">
        <h3>Asistencias del d√≠a</h3>
        <canvas id="graficoDiaElectronica"></canvas>
      </div>
    </div>
  </div>
        </section>



        <!-- Secci√≥n Asistencias -->
        <section id="asistencias" class="section">
            <div class="section-content">
                <!-- Filtros -->
                <div class="filter-container">
                    <h3>üîç Filtros de B√∫squeda</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="filtroEspecialidad">Especialidad</label>
                            <select id="filtroEspecialidad" onchange="filtrar()">
                                <option value="">Todas las especialidades</option>
                                <option value="arquitectura">Arquitectura</option>
                                <option value="enfermeria">Enfermer√≠a</option>
                                <option value="agropecuaria">Agropecuaria</option>
                                <option value="contabilidad">Contabilidad</option>
                                <option value="electronica">Electr√≥nica</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="filtroA√±o">A√±o</label>
                            <input type="number" id="filtroA√±o" min="2020" max="2030" onchange="filtrar()">
                        </div>

                        <div class="filter-group">
                            <label for="filtroMes">Mes</label>
                            <input type="number" id="filtroMes" min="1" max="12" onchange="filtrar()">
                        </div>

                        <div class="filter-group">
                            <label for="filtroDia">D√≠a</label>
                            <input type="number" id="filtroDia" min="1" max="31" onchange="filtrar()">
                        </div>
                    </div>
                </div>

                <!-- Resumen de resultados -->
                <div class="cards-container">
                    <div class="card">
                        <h3>Resumen de Asistencias</h3>
                        <p id="totalEstudiantes" class="stat-value">Cargando...</p>
                        <canvas id="asistenciaGraficoCircular"></canvas>
                    </div>
                </div>

                <!-- Tabla de asistencias -->
                <div class="card">
                    <h3>Registro Detallado de Asistencias</h3>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th>Especialidad</th>
                                    <th>Ciclo</th>
                                    <th>Hora</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="tablaAsistenciasBody">
                                <tr>
                                    <td colspan="6" class="loading">Cargando datos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n Top 10 -->
        <section id="top10" class="section">
    <div class="section-content">
        <div class="card">
           <h3 style="display: flex; justify-content: space-between; align-items: center;">
    üèÜ Top 10 Estudiantes con Mejor Asistencia
    <select id="top10SelectorAnio" onchange="cambiarAnioTop10()" style="padding: 4px; border-radius: 6px;">
        <!-- Se llenar√° por JS -->
    </select>
</h3>
            <div class="top-list" id="top10Lista">
                <!-- Se llenar√° desde JS -->
            </div>
        </div>
    </div>
</section>

        <!-- Secci√≥n Alumnos -->
        <section id="alumnos" class="section">
            <div class="section-content">
                <div class="loading">Cargando datos de alumnos...</div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    
    <script src="../assets/js/chartjs/general/semana.js"></script>
    <script src="../assets/js/chartjs/general/hoy.js"></script>
    <script src="../assets/js/chartjs/general/a√±o.js"></script>
    <script src="../assets/js/chartjs/general/mes.js"></script>

<script src="../assets/js/graficos.js"></script>

        <script src="../assets/js/chartjs/top10.js"></script>

    <script src="../assets/js/chartjs/asistencias/asistenciaFecha.js"></script>

    <script>
        // Funci√≥n para filtrar por especialidad desde el select del sidebar
        function filtrarPorEspecialidad(especialidad) {
            // Cambiar a la secci√≥n de asistencias
            mostrarSeccion(especialidad);
            
            // Establecer el filtro de especialidad
            setTimeout(() => {
                const filtroEspecialidad = document.getElementById('filtroEspecialidad');
                if (filtroEspecialidad) {
                    filtroEspecialidad.value = especialidad;
                    filtrar();
                }
            }, 100);
        }

        // Configuraci√≥n inicial cuando el DOM est√° listo
        document.addEventListener("DOMContentLoaded", () => {
            // Configurar fechas por defecto
            const hoy = new Date();
            const filtroA√±o = document.getElementById("filtroA√±o");
            const filtroMes = document.getElementById("filtroMes");
            const filtroDia = document.getElementById("filtroDia");
            
            if (filtroA√±o) filtroA√±o.value = hoy.getFullYear();
            if (filtroMes) filtroMes.value = hoy.getMonth() + 1;
            if (filtroDia) filtroDia.value = hoy.getDate();
            
            // Ejecutar filtrado inicial despu√©s de un breve delay
            setTimeout(filtrar, 1000);
        });

        // Manejar redimensionamiento de ventana
        window.addEventListener('resize', function() {
            // Cerrar sidebar en m√≥vil si se redimensiona a desktop
            if (window.innerWidth > 768) {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                if (sidebar) sidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>